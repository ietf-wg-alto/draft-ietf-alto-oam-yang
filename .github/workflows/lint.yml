name: "Validate YANG Modules"

on:
  push:
    paths:
    - '**.yang'
    - '.github/workflows/lint.yml'
  pull_request:
    paths:
    - '**.yang'
    - '.github/workflows/lint.yml'

jobs:
  yang-catalog:
    name: "Validate using YANG Catalog API"
    runs-on: ubuntu-latest
    steps:
    - name: "Checkout"
      uses: actions/checkout@v5

    - name: "Install dependencies"
      run: |
        # Install Ruby gems for i-d-template (kramdown-rfc)
        gem install kramdown-rfc --user-install --no-document
        
        # Add gem bin directory to PATH (gem installs to ~/.local/share/gem)
        echo "$HOME/.local/share/gem/ruby/3.2.0/bin" >> $GITHUB_PATH
        
        # Install Python tools needed for draft generation
        pip install xml2rfc

    - name: "Generate draft"
      run: |
        # Generate the draft file (this embeds YANG modules with xym tags)
        make

    - name: "Validate YANG modules using fno2010/ietf-yang-validator"
      uses: fno2010/ietf-yang-validator@v1.1
      with:
        source: "draft-ietf-alto-oam-yang.txt"
        validation-mode: "local"
        validators: "pyang,yanglint"
        fail-on-errors: "true"
